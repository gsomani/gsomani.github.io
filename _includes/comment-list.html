<script type="module">
import { Octokit } from "https://esm.sh/@octokit/rest";
const octokit = new Octokit({ auth: 'github_pat_{{site.token}}'});

const owner = "{{site.owner}}";
const repo = "{{site.blog_repo}}";
const issueNumber = {{page.issue}};

function extractComment(comments)
{
  var data = new Array();

  for (const [key, value] of Object.entries(comments))
  {
    var cur = JSON.parse(value.body);
    cur['date'] = value.created_at;
    data.push(cur);
    console.log(value);
  }
  return data;
}

function readIssueComments() {
  var comments;
  octokit.request('GET /repos/{owner}/{repo}/issues/{issue_number}/comments', {
    owner,
    repo,
    issue_number: issueNumber
  }).then(response => {comments = extractComment(response.data));})
  .catch(error => {
    console.error('Error fetching comments:', error);
  });
  console.log(comments);
}

window.readIssueComments = readIssueComments;

</script>

<body onload=readIssueComments()></body>
<!----
<div class="comment">
  <h3>{{comment.name}}</h3>
  {% if page.layout == 'message_read' %}
  <h3>({{comment.email}})</h3>
  {% endif %}
  <time
    class="post-meta dt-published"
    datetime="{{ page.date | date_to_xmlschema }}"
    itemprop="datePublished"
  >
    {%- assign date_format = site.minima.date_format | default: "%b %-d, %Y" -%}
    {{ comment.date | date:"%H:%M - %b %-d, %Y" }}
  </time>
  <p>{{comment.message | strip_html | markdownify }}</p>
  {% endif %}
</div>
{% endfor %}

---!>
